<!DOCTYPE html>
<html lang="en">

<head>
    <title>VividCortex reCaptcha Directive Example</title>

    <!-- Bootstrap is NOT required, it's just here to make the demo look better -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Include AngularJS -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-resource.js"></script>

    <!-- Include the JS ReCaptcha API -->
    <script src="//www.google.com/recaptcha/api.js?render=explicit&onload=vcRecaptchaApiLoaded" async defer></script>

    <!-- Include the ngReCaptcha directive -->
    <script src="/recaptcha/angular-recaptcha.js"></script>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" charset="utf-8"></script>

    <!-- define your app and make it depend on vcRecaptcha module -->
    <script>
        var app = angular.module('testApp', ['vcRecaptcha', 'ngResource']);

        app.controller('testCtrl', ['$scope', '$resource', function($scope, $resource, vcRecaptchaService, $http) {

            var Captcha = $resource('/api/captcha');

            console.log("this is your app's controller");
            $scope.response = null;
            $scope.widgetId = null;

            $scope.model = {
                key: '6Le13AoUAAAAANXjenfUkzziarYKxxtBAhPtzLD_'
            };

            $scope.setResponse = function(response) {
                console.info('Response available');

                $scope.response = response;
            };

            $scope.setWidgetId = function(widgetId) {
                console.info('Created widget ID: %s', widgetId);

                $scope.widgetId = widgetId;
            };

            $scope.cbExpiration = function() {
                console.info('Captcha expired. Resetting response object');

                vcRecaptchaService.reload($scope.widgetId);

                $scope.response = null;
            };

            $scope.submit = function(response) {

                var valid;

                console.log('sending the captcha response to the server', $scope.response);

                var captcha = new Captcha();
                captcha.response = $scope.response;
                captcha.data2 = 'kaan';
                captcha.$save(function(result) {
                    console.log("bitti");
                    console.log(result);
                });


                // if (valid) {
                //     console.log('Success');
                // } else {
                //     console.log('Failed validation');
                //
                //     // In case of a failed validation you need to reload the captcha
                //     // because each response can be checked just once
                //     vcRecaptchaService.reload($scope.widgetId);
                // }
            };

        }]);
    </script>

</head>

<body>
    <div class="container" ng-app="testApp" ng-controller="testCtrl">

        <h2>Test 123</h2>

        <form ng-submit="submit()">
            <div vc-recaptcha theme="'light'" key="'6Le13AoUAAAAAHgsf71tcD9cOjlZiHOPxqWowT1d'" on-create="setWidgetId(widgetId)" on-success="setResponse(response)" on-expire="cbExpiration()"></div>
            <button class="btn" type="submit">Submit</button>
        </form>

    </div>
</body>

</html>
